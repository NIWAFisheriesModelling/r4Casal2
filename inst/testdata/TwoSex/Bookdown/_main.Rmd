--- 
title: "A Minimal Book Example"
author: "John Doe"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: book
bibliography: [book.bib, packages.bib]
# url: your book url like https://bookdown.org/yihui/bookdown
# cover-image: path to the social sharing image like images/cover.jpg
description: |
  This is a minimal example of using the bookdown package to write a book.
  The HTML output format for this example is bookdown::gitbook,
  set in the _output.yml file.
link-citations: yes
github-repo: rstudio/bookdown-demo
---

# About

This is a _sample_ book written in **Markdown**. You can use anything that Pandoc's Markdown supports; for example, a math equation $a^2 + b^2 = c^2$.

## Usage 

Each **bookdown** chapter is an .Rmd file, and each .Rmd file can contain one (and only one) chapter. A chapter *must* start with a first-level heading: `# A good chapter`, and can contain one (and only one) first-level heading.

Use second-level and higher headings within chapters like: `## A short section` or `### An even shorter section`.

The `index.Rmd` file is required, and is also your first book chapter. It will be the homepage when you render the book.

## Render book

You can render the HTML version of this example book without changing anything:

1. Find the **Build** pane in the RStudio IDE, and

1. Click on **Build Book**, then select your output format, or select "All formats" if you'd like to use multiple formats from the same book source files.

Or build the book from the R console:

```{r, eval=FALSE}
bookdown::render_book()
```

To render this example to PDF as a `bookdown::pdf_book`, you'll need to install XeLaTeX. You are recommended to install TinyTeX (which includes XeLaTeX): <https://yihui.org/tinytex/>.

## Preview book

As you work, you may start a local server to live preview this HTML book. This preview will update as you edit the book when you save individual .Rmd files. You can start the server in a work session by using the RStudio add-in "Preview book", or from the R console:

```{r eval=FALSE}
bookdown::serve_book()
```


```{r include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown'
), 'packages.bib')
```

<!--chapter:end:index.Rmd-->

# Model structure {#inputs}

## Read in neccessary R libraries

```{r install_packages, results = 'hide', message=FALSE, warning=FALSE}
library(r4Casal2)
library(Casal2)
library(knitr)
library(ggplot2)
library(dplyr)
library(reshape2)
```


```{r set_path, eval = T, echo = F}
csl_dir = "C:/Software/r4Casal2/inst/testdata/TwoSex"
```
```{r read_in_info, eval = T, echo = T, results = F}
cas2_mpd = extract.mpd(file = 'estimate_betadiff.log', path = csl_dir)
config_summary = summarise_config(config_file = 'config_betadiff.csl2', config_dir = csl_dir)
catches_melted = melt(config_summary$catch_df, id.vars = c("process", "year"))
```



## Input catches

```{r plot_input_catches, eval = T, echo = T, results = T,fig.cap = "Catch by fishery over time"}
ggplot(catches_melted, aes(x = year, y = value, col = variable)) +
  geom_line(size = 1.5) +
  labs(x = "Year", y = "Catch (t)", col = "Fishery")
```



## Input Observations

```{r plot_input_observations, eval = T, echo = T, results = T,fig.cap = "Years in which observations are calculated"}
ggplot(config_summary$obs_year_df, aes(x = year, y = observation, col = observation, size = active)) +
  geom_point() +
  guides(colour = "none", size = "none")
```



## Annual cycle

```{r table_annual_cycle, eval = T, echo = T, results = T}
kable(x = config_summary$time_step_df,format = 'html', tab.attr = "style='width:100%;'")
```



## The Partition

```{r table_partition, eval = T, echo = T, results = T}
kable(x = config_summary$full_category_df,format = 'html', tab.attr = "style='width:100%;'")
```



## Estimated parameters

```{r table_est_pars, eval = T, echo = T, results = T}
kable(x = config_summary$estimate_df,format = 'html', tab.attr = "style='width:100%;'")
```




<!--chapter:end:01-ModelInputs.Rmd-->

# Model fit to observations {#modelfit}
## Abundance/Biomass 

```{r abundance_fits, eval = T, echo = T}
plot_relative_index(cas2_mpd, plot_type = 'classic')
plot_relative_index(cas2_mpd, plot_type = 'classic_ribbon')
plot_relative_index(cas2_mpd, plot_type = 'residual')
``` 

## Composition 

```{r comp_fits, eval = T, echo = T}
plot_compositional_observations(cas2_mpd)
``` 


<!--chapter:end:02-ModelFits.Rmd-->

# Model quantities {#modelquantities}
## SSB 

```{r ssb, eval = T, echo = T}
plot_derived_quantities(cas2_mpd)
``` 

## Recruitment 

```{r recruit, eval = T, echo = T}
plot_recruitment(model = cas2_mpd, quantity = 'ycs_values') + ylab('YCS values')
plot_recruitment(model = cas2_mpd, quantity = 'standardised_ycs') + ylab('Standardised YCS values')
plot_recruitment(model = cas2_mpd, quantity = 'true_ycs') + ylab('True YCS values')
``` 

## Exploitation 

```{r exploitation, eval = T, echo = T}
plot_pressure(model = cas2_mpd, quantity = 'fishing_pressure') + ylab('Fishing Pressure')
plot_pressure(model = cas2_mpd, quantity = 'exploitation') + ylab('Exploitation')
plot_pressure(model = cas2_mpd, quantity = 'actual_catch') + ylab('Actual Catch')
``` 

## Selectivities 

```{r selectivities, eval = T, echo = T}
plot_selectivities(model = cas2_mpd)
``` 


<!--chapter:end:02-ModelQuantities.Rmd-->

`r if (knitr::is_html_output()) '
# References {-}
'`

<!--chapter:end:07-references.Rmd-->

