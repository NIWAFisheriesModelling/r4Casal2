<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 MPD summaries | r4Casal2</title>
  <meta name="description" content="This book demonstrates how to use r4Casal2 to make your Casal2 experience better." />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 MPD summaries | r4Casal2" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This book demonstrates how to use r4Casal2 to make your Casal2 experience better." />
  <meta name="github-repo" content="https://github.com/NIWAFisheriesModelling/r4Casal2" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 MPD summaries | r4Casal2" />
  
  <meta name="twitter:description" content="This book demonstrates how to use r4Casal2 to make your Casal2 experience better." />
  

<meta name="author" content="C.Marsh" />


<meta name="date" content="2022-10-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="summariseinputs.html"/>
<link rel="next" href="summarisemultipleinputs.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">r4Casal2</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcolme to <strong>r4Casal2</strong></a></li>
<li class="chapter" data-level="2" data-path="functionlist.html"><a href="functionlist.html"><i class="fa fa-check"></i><b>2</b> A list of key functions in the <code>r4Casal2</code> package</a>
<ul>
<li class="chapter" data-level="2.1" data-path="functionlist.html"><a href="functionlist.html#accessor-functions"><i class="fa fa-check"></i><b>2.1</b> Accessor functions</a></li>
<li class="chapter" data-level="2.2" data-path="functionlist.html"><a href="functionlist.html#other-useful-functions"><i class="fa fa-check"></i><b>2.2</b> Other useful functions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="summariseinputs.html"><a href="summariseinputs.html"><i class="fa fa-check"></i><b>3</b> Summarise configuration inputs</a>
<ul>
<li class="chapter" data-level="3.1" data-path="summariseinputs.html"><a href="summariseinputs.html#example-files"><i class="fa fa-check"></i><b>3.1</b> Example files</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mpd-summaries.html"><a href="mpd-summaries.html"><i class="fa fa-check"></i><b>4</b> MPD summaries</a>
<ul>
<li class="chapter" data-level="4.1" data-path="mpd-summaries.html"><a href="mpd-summaries.html#single-model-output"><i class="fa fa-check"></i><b>4.1</b> Single Model Output</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="mpd-summaries.html"><a href="mpd-summaries.html#model-convergence"><i class="fa fa-check"></i><b>4.1.1</b> Model Convergence</a></li>
<li class="chapter" data-level="4.1.2" data-path="mpd-summaries.html"><a href="mpd-summaries.html#data-weighting"><i class="fa fa-check"></i><b>4.1.2</b> Data Weighting</a></li>
<li class="chapter" data-level="4.1.3" data-path="mpd-summaries.html"><a href="mpd-summaries.html#model-quantities"><i class="fa fa-check"></i><b>4.1.3</b> Model quantities</a></li>
<li class="chapter" data-level="4.1.4" data-path="mpd-summaries.html"><a href="mpd-summaries.html#plotting-fits"><i class="fa fa-check"></i><b>4.1.4</b> Plotting Fits</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="mpd-summaries.html"><a href="mpd-summaries.html#multiple-casal2-runs-with--i-or--s"><i class="fa fa-check"></i><b>4.2</b> Multiple Casal2 runs with -i or -s</a>
<ul>
<li class="chapter" data-level="" data-path="mpd-summaries.html"><a href="mpd-summaries.html#plotting-selectivities-1"><i class="fa fa-check"></i>Plotting selectivities</a></li>
<li class="chapter" data-level="" data-path="mpd-summaries.html"><a href="mpd-summaries.html#plotting-fits-1"><i class="fa fa-check"></i>Plotting Fits</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="summarisemultipleinputs.html"><a href="summarisemultipleinputs.html"><i class="fa fa-check"></i><b>5</b> Comparing multiple MPD runs</a>
<ul>
<li class="chapter" data-level="5.1" data-path="summarisemultipleinputs.html"><a href="summarisemultipleinputs.html#read-in-models"><i class="fa fa-check"></i><b>5.1</b> Read in models</a></li>
<li class="chapter" data-level="5.2" data-path="summarisemultipleinputs.html"><a href="summarisemultipleinputs.html#compare-model-outputs"><i class="fa fa-check"></i><b>5.2</b> Compare model outputs</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="summarisemultipleinputs.html"><a href="summarisemultipleinputs.html#selectivities"><i class="fa fa-check"></i><b>5.2.1</b> selectivities</a></li>
<li class="chapter" data-level="5.2.2" data-path="summarisemultipleinputs.html"><a href="summarisemultipleinputs.html#derived-quantities"><i class="fa fa-check"></i><b>5.2.2</b> Derived quantities</a></li>
<li class="chapter" data-level="5.2.3" data-path="summarisemultipleinputs.html"><a href="summarisemultipleinputs.html#recruitment"><i class="fa fa-check"></i><b>5.2.3</b> Recruitment</a></li>
<li class="chapter" data-level="5.2.4" data-path="summarisemultipleinputs.html"><a href="summarisemultipleinputs.html#abundance-fits"><i class="fa fa-check"></i><b>5.2.4</b> Abundance fits</a></li>
<li class="chapter" data-level="5.2.5" data-path="summarisemultipleinputs.html"><a href="summarisemultipleinputs.html#compare-objective-function"><i class="fa fa-check"></i><b>5.2.5</b> Compare objective function</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mcmc.html"><a href="mcmc.html"><i class="fa fa-check"></i><b>6</b> MCMC</a>
<ul>
<li class="chapter" data-level="6.1" data-path="mcmc.html"><a href="mcmc.html#read-in-models-1"><i class="fa fa-check"></i><b>6.1</b> Read in models</a></li>
<li class="chapter" data-level="6.2" data-path="mcmc.html"><a href="mcmc.html#diagnostics"><i class="fa fa-check"></i><b>6.2</b> Diagnostics</a></li>
<li class="chapter" data-level="6.3" data-path="mcmc.html"><a href="mcmc.html#plotting-quantities"><i class="fa fa-check"></i><b>6.3</b> Plotting quantities</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="mcmc.html"><a href="mcmc.html#selectivities-1"><i class="fa fa-check"></i><b>6.3.1</b> selectivities</a></li>
<li class="chapter" data-level="6.3.2" data-path="mcmc.html"><a href="mcmc.html#derived-quantities-1"><i class="fa fa-check"></i><b>6.3.2</b> Derived quantities</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="PPC.html"><a href="PPC.html"><i class="fa fa-check"></i><b>7</b> Posterior Predictive Checks</a>
<ul>
<li class="chapter" data-level="7.1" data-path="PPC.html"><a href="PPC.html#introduction"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="PPC.html"><a href="PPC.html#estimation"><i class="fa fa-check"></i><b>7.2</b> Estimation</a></li>
<li class="chapter" data-level="7.3" data-path="PPC.html"><a href="PPC.html#simulations"><i class="fa fa-check"></i><b>7.3</b> Simulations</a></li>
<li class="chapter" data-level="7.4" data-path="PPC.html"><a href="PPC.html#summarising-simulated-data-in-r"><i class="fa fa-check"></i><b>7.4</b> Summarising simulated data in R</a></li>
<li class="chapter" data-level="7.5" data-path="PPC.html"><a href="PPC.html#posterior-predictive-checks"><i class="fa fa-check"></i><b>7.5</b> Posterior predictive checks</a></li>
<li class="chapter" data-level="7.6" data-path="PPC.html"><a href="PPC.html#pit-residuals"><i class="fa fa-check"></i><b>7.6</b> PIT residuals</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="presentwithBookdown.html"><a href="presentwithBookdown.html"><i class="fa fa-check"></i><b>8</b> Presenting Models using Bookdown</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/NIWAFisheriesModelling/r4Casal2" target="blank">Github Repo here</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">r4Casal2</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mpd-summaries" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> MPD summaries<a href="mpd-summaries.html#mpd-summaries" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="single-model-output" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Single Model Output<a href="mpd-summaries.html#single-model-output" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="mpd-summaries.html#cb10-1" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">=</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>,<span class="st">&quot;SimpleTestModel&quot;</span>, </span>
<span id="cb10-2"><a href="mpd-summaries.html#cb10-2" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;estimate.log&quot;</span>, <span class="at">package =</span> <span class="st">&quot;r4Casal2&quot;</span>, <span class="at">mustWork =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-3"><a href="mpd-summaries.html#cb10-3" aria-hidden="true" tabindex="-1"></a>mpd <span class="ot">=</span> <span class="fu">extract.mpd</span>(<span class="at">file =</span> file_name)</span></code></pre></div>
<div id="model-convergence" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Model Convergence<a href="mpd-summaries.html#model-convergence" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are a range of appproaches for checking your model has converged. The approaches we will be working through include checking the hessian is positive definite, checking parameters are not running to bounds and reestimate with random starting locations.</p>
<p>When estimating models in Casal2, it is recommended to have the following report included</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="mpd-summaries.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">@report</span> covariance_matrix</span>
<span id="cb11-2"><a href="mpd-summaries.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span> covariance_matrix</span>
<span id="cb11-3"><a href="mpd-summaries.html#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">## or the Hessian</span></span>
<span id="cb11-4"><a href="mpd-summaries.html#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="ex">@report</span> hessian_matrix</span>
<span id="cb11-5"><a href="mpd-summaries.html#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span> hessian_matrix</span></code></pre></div>
<p>When estimation is complete and you have read in the Casal2 output using <code>Casal2::extract.mpd()</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="mpd-summaries.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># file name</span></span>
<span id="cb12-2"><a href="mpd-summaries.html#cb12-2" aria-hidden="true" tabindex="-1"></a>mpd_file_name <span class="ot">=</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;PosteriorPredictiveChecks&quot;</span>,<span class="st">&quot;estimate.log&quot;</span>, </span>
<span id="cb12-3"><a href="mpd-summaries.html#cb12-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">package =</span> <span class="st">&quot;r4Casal2&quot;</span>, <span class="at">mustWork =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-4"><a href="mpd-summaries.html#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># read in output</span></span>
<span id="cb12-5"><a href="mpd-summaries.html#cb12-5" aria-hidden="true" tabindex="-1"></a>mpd <span class="ot">=</span> <span class="fu">extract.mpd</span>(<span class="at">file =</span> mpd_file_name)</span>
<span id="cb12-6"><a href="mpd-summaries.html#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># is covariance symetric</span></span>
<span id="cb12-7"><a href="mpd-summaries.html#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">isSymmetric</span>(mpd<span class="sc">$</span>covar<span class="sc">$</span>covariance_matrix)</span>
<span id="cb12-8"><a href="mpd-summaries.html#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># is hessian invertable</span></span>
<span id="cb12-9"><a href="mpd-summaries.html#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">is_matrix_invertable</span>(mpd<span class="sc">$</span>hess<span class="sc">$</span>hessian_matrix)</span>
<span id="cb12-10"><a href="mpd-summaries.html#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># check high correlations</span></span>
<span id="cb12-11"><a href="mpd-summaries.html#cb12-11" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="ot">=</span> <span class="fu">cov2cor</span>(mpd<span class="sc">$</span>covar<span class="sc">$</span>covariance_matrix)</span>
<span id="cb12-12"><a href="mpd-summaries.html#cb12-12" aria-hidden="true" tabindex="-1"></a>corr_df <span class="ot">=</span> <span class="fu">get_high_correlations</span>(<span class="at">correlation_matrix =</span> correlation_matrix, <span class="at">max_correlation =</span> <span class="fl">0.8</span>, </span>
<span id="cb12-13"><a href="mpd-summaries.html#cb12-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">names</span>(mpd<span class="sc">$</span>estimate_value<span class="sc">$</span>values))</span>
<span id="cb12-14"><a href="mpd-summaries.html#cb12-14" aria-hidden="true" tabindex="-1"></a>corr_df<span class="sc">$</span>correlation <span class="ot">=</span> <span class="fu">round</span>(corr_df<span class="sc">$</span>correlation, <span class="dv">3</span>)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="mpd-summaries.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="at">x =</span> corr_df[,<span class="fu">c</span>(<span class="st">&quot;correlation&quot;</span>, <span class="st">&quot;row_param&quot;</span>, <span class="st">&quot;col_param&quot;</span>)], </span>
<span id="cb13-2"><a href="mpd-summaries.html#cb13-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;Correlated Parameters&quot;</span>)</span></code></pre></div>
<table>
<caption>(#tab:correlated_params)Correlated Parameters</caption>
<colgroup>
<col width="13%" />
<col width="43%" />
<col width="43%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">correlation</th>
<th align="left">row_param</th>
<th align="left">col_param</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-0.974</td>
<td align="left">process<a href="summarisemultipleinputs.html#recruitment">Recruitment</a>.b0</td>
<td align="left">catchability[chatTANq].q</td>
</tr>
<tr class="even">
<td align="right">0.830</td>
<td align="left">selectivity[chatTANSel].mu</td>
<td align="left">selectivity[chatTANSel].sigma_l</td>
</tr>
<tr class="odd">
<td align="right">0.951</td>
<td align="left">selectivity[eastFSel].mu</td>
<td align="left">selectivity[eastFSel].sigma_l</td>
</tr>
<tr class="even">
<td align="right">0.925</td>
<td align="left">selectivity[westFSel].mu</td>
<td align="left">selectivity[westFSel].sigma_l</td>
</tr>
<tr class="odd">
<td align="right">0.810</td>
<td align="left">process<a href="summarisemultipleinputs.html#recruitment">Recruitment</a>.ycs_values{1978}</td>
<td align="left">process<a href="summarisemultipleinputs.html#recruitment">Recruitment</a>.ycs_values{1979}</td>
</tr>
<tr class="even">
<td align="right">0.818</td>
<td align="left">process<a href="summarisemultipleinputs.html#recruitment">Recruitment</a>.ycs_values{1979}</td>
<td align="left">process<a href="summarisemultipleinputs.html#recruitment">Recruitment</a>.ycs_values{1980}</td>
</tr>
<tr class="odd">
<td align="right">0.827</td>
<td align="left">process<a href="summarisemultipleinputs.html#recruitment">Recruitment</a>.ycs_values{1980}</td>
<td align="left">process<a href="summarisemultipleinputs.html#recruitment">Recruitment</a>.ycs_values{1981}</td>
</tr>
<tr class="even">
<td align="right">0.831</td>
<td align="left">process<a href="summarisemultipleinputs.html#recruitment">Recruitment</a>.ycs_values{1981}</td>
<td align="left">process<a href="summarisemultipleinputs.html#recruitment">Recruitment</a>.ycs_values{1982}</td>
</tr>
<tr class="odd">
<td align="right">0.835</td>
<td align="left">process<a href="summarisemultipleinputs.html#recruitment">Recruitment</a>.ycs_values{1982}</td>
<td align="left">process<a href="summarisemultipleinputs.html#recruitment">Recruitment</a>.ycs_values{1983}</td>
</tr>
</tbody>
</table>
<p>You will want to try remove high correlations from the covariance to help estimation and MCMC simulations. We recommend you explore parameter transformations to remove high correlations or alternative parameterisations.</p>
<p>Once these are satisfied you will have more confidence in your standard errors, in addition to being able to run MCMC run mode.</p>
<p>Another useful convergence diagnostic is re-estimating Casal2 with difference starting locations. The function used for this is <code>?generate.starting.pars</code>. This will read a Casal2 config file that contains all the <code>@estimate</code> definitions are generate a bunch of random starting values in the format of useable for <code>-i</code> in Casal2. Below is some example R code of running Casal2 from R with randomly generated starting values.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="mpd-summaries.html#cb14-1" aria-hidden="true" tabindex="-1"></a>working_dir <span class="ot">=</span> <span class="st">&quot;Directory to Casal output&quot;</span></span>
<span id="cb14-2"><a href="mpd-summaries.html#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="do">## generate starting values</span></span>
<span id="cb14-3"><a href="mpd-summaries.html#cb14-3" aria-hidden="true" tabindex="-1"></a>start_pars <span class="ot">=</span> <span class="fu">generate.starting.pars</span>(<span class="at">path =</span> working_dir, </span>
<span id="cb14-4"><a href="mpd-summaries.html#cb14-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">estimation_csl2_file  =</span> <span class="st">&quot;estimation.csl2&quot;</span>,</span>
<span id="cb14-5"><a href="mpd-summaries.html#cb14-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">par_file_name =</span> <span class="st">&quot;starting_pars.out&quot;</span>)</span>
<span id="cb14-6"><a href="mpd-summaries.html#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="do">## re-run Casal2</span></span>
<span id="cb14-7"><a href="mpd-summaries.html#cb14-7" aria-hidden="true" tabindex="-1"></a>current_dir <span class="ot">=</span> <span class="fu">getwd</span>()</span>
<span id="cb14-8"><a href="mpd-summaries.html#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(working_dir)</span>
<span id="cb14-9"><a href="mpd-summaries.html#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">system2</span>(<span class="at">command =</span> <span class="st">&quot;casal2&quot;</span>, <span class="at">args =</span> <span class="st">&quot;-e -o multi_start_pars.par -i starting_pars.out&quot;</span>,</span>
<span id="cb14-10"><a href="mpd-summaries.html#cb14-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">stdout =</span> <span class="st">&quot;multi_start.log&quot;</span>,</span>
<span id="cb14-11"><a href="mpd-summaries.html#cb14-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">stderr =</span> <span class="st">&quot;multi_start.err&quot;</span>, <span class="at">wait=</span><span class="cn">TRUE</span>)</span>
<span id="cb14-12"><a href="mpd-summaries.html#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="fu">system2</span>(<span class="at">command =</span> <span class="st">&quot;casal2&quot;</span>, <span class="at">args =</span> <span class="st">&quot;-r -i starting_pars.out&quot;</span>,</span>
<span id="cb14-13"><a href="mpd-summaries.html#cb14-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">stdout =</span> <span class="st">&quot;multi_start_init.log&quot;</span>,</span>
<span id="cb14-14"><a href="mpd-summaries.html#cb14-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">stderr =</span> <span class="st">&quot;multi_start_init.err&quot;</span>, <span class="at">wait=</span><span class="cn">TRUE</span>)</span>
<span id="cb14-15"><a href="mpd-summaries.html#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(current_dir)</span>
<span id="cb14-16"><a href="mpd-summaries.html#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="mpd-summaries.html#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="do">## read in jitter_start run</span></span>
<span id="cb14-18"><a href="mpd-summaries.html#cb14-18" aria-hidden="true" tabindex="-1"></a>multi_est <span class="ot">=</span> <span class="fu">extract.mpd</span>(<span class="st">&quot;multi_start.log&quot;</span>, <span class="at">path =</span> working_dir)</span>
<span id="cb14-19"><a href="mpd-summaries.html#cb14-19" aria-hidden="true" tabindex="-1"></a>multi_run <span class="ot">=</span> <span class="fu">extract.mpd</span>(<span class="st">&quot;multi_start_init.log&quot;</span>, <span class="at">path =</span> working_dir)</span>
<span id="cb14-20"><a href="mpd-summaries.html#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="do">## check if any didn&#39;t converge</span></span>
<span id="cb14-21"><a href="mpd-summaries.html#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="mpd-summaries.html#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="do">## plot SSBS</span></span>
<span id="cb14-23"><a href="mpd-summaries.html#cb14-23" aria-hidden="true" tabindex="-1"></a>ssb_df <span class="ot">=</span> <span class="fu">get_derived_quanitites</span>(multi_est)</span>
<span id="cb14-24"><a href="mpd-summaries.html#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ssb_df, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> values, <span class="at">col =</span> par_set, <span class="at">linetype =</span> par_set)) <span class="sc">+</span></span>
<span id="cb14-25"><a href="mpd-summaries.html#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb14-26"><a href="mpd-summaries.html#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Years&quot;</span>,<span class="at">y =</span> <span class="st">&quot;SSB&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;Starting</span><span class="sc">\n</span><span class="st">values&quot;</span>, <span class="at">col =</span> <span class="st">&quot;Starting</span><span class="sc">\n</span><span class="st">values&quot;</span>)</span>
<span id="cb14-27"><a href="mpd-summaries.html#cb14-27" aria-hidden="true" tabindex="-1"></a>ssb_df <span class="ot">=</span> <span class="fu">get_derived_quanitites</span>(multi_run)</span>
<span id="cb14-28"><a href="mpd-summaries.html#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ssb_df, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> values, <span class="at">col =</span> par_set, <span class="at">linetype =</span> par_set)) <span class="sc">+</span></span>
<span id="cb14-29"><a href="mpd-summaries.html#cb14-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb14-30"><a href="mpd-summaries.html#cb14-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Years&quot;</span>,<span class="at">y =</span> <span class="st">&quot;SSB&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;Starting</span><span class="sc">\n</span><span class="st">values&quot;</span>, <span class="at">col =</span> <span class="st">&quot;Starting</span><span class="sc">\n</span><span class="st">values&quot;</span>)</span>
<span id="cb14-31"><a href="mpd-summaries.html#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="mpd-summaries.html#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="do">## get aggregated objective functions</span></span>
<span id="cb14-33"><a href="mpd-summaries.html#cb14-33" aria-hidden="true" tabindex="-1"></a>obj <span class="ot">=</span> <span class="fu">aggregate_objective_report</span>(<span class="at">model =</span> multi_est)</span>
<span id="cb14-34"><a href="mpd-summaries.html#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(obj)</span></code></pre></div>
<p>A useful diagnostic that is encouraged to explore is to run Casal2 as an age-structured population model (ASPM) <span class="citation">(<a href="#ref-MINTEVERA2017114" role="doc-biblioref">Minte-Vera et al. 2017</a>; <a href="#ref-CARVALHO2021105959" role="doc-biblioref">Carvalho et al. 2021</a>)</span>. This is useful for asking the following question “do we need to know the variability in recruitment to get the “correct” trends in relative abundance and the absolute scale of the model?” The diagnostic is run following these steps
1. Estimate the full integrated model
2. Fix selectivity parameters at MPD values from step 2
3. Turn off recruitment variability i.e., assume <span class="math inline">\(R_0\)</span> for all years
4. fit the model (ASPM) to the indices of abundance only. Just estimating <span class="math inline">\(R_0\)</span>, <span class="math inline">\(q\)</span> etc.
5. fit the above model again but estimate YCS parameters (ASPMdev)
6. fit the model again with the recruitment deviates set equal to the MPD values from the integrated model (ASPMfix)</p>
<p>This runs will help you explore the fit and production assumptions in the data. The idea is to understand what parameters are informing what population signals and how perhaps identify misspecifications. For more information on this diagnostic we recommend users read <span class="citation">Minte-Vera et al. (<a href="#ref-MINTEVERA2017114" role="doc-biblioref">2017</a>)</span>.</p>
</div>
<div id="data-weighting" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Data Weighting<a href="mpd-summaries.html#data-weighting" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Some pseudo r code to help with data weighting according to <span class="citation">Francis (<a href="#ref-francis2011data" role="doc-biblioref">2011</a>)</span> with multinomial data.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="mpd-summaries.html#cb15-1" aria-hidden="true" tabindex="-1"></a>working_dir <span class="ot">=</span> <span class="st">&quot;Directory to Casal output&quot;</span></span>
<span id="cb15-2"><a href="mpd-summaries.html#cb15-2" aria-hidden="true" tabindex="-1"></a>reweight_folder <span class="ot">=</span> <span class="st">&quot;Reweight&quot;</span></span>
<span id="cb15-3"><a href="mpd-summaries.html#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Don&#39;t always want to re-run this code</span></span>
<span id="cb15-4"><a href="mpd-summaries.html#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="cn">FALSE</span>) {</span>
<span id="cb15-5"><a href="mpd-summaries.html#cb15-5" aria-hidden="true" tabindex="-1"></a>  weights <span class="ot">=</span> <span class="fu">run_automatic_reweighting</span>(<span class="at">config_dir =</span> working_dir,</span>
<span id="cb15-6"><a href="mpd-summaries.html#cb15-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">config_filename =</span> <span class="st">&quot;config.csl2&quot;</span>,</span>
<span id="cb15-7"><a href="mpd-summaries.html#cb15-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">weighting_folder_name =</span> reweight_folder,</span>
<span id="cb15-8"><a href="mpd-summaries.html#cb15-8" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">mpd_file_name =</span> <span class="st">&quot;estimate.log&quot;</span>,</span>
<span id="cb15-9"><a href="mpd-summaries.html#cb15-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">n_loops =</span> <span class="dv">3</span>, </span>
<span id="cb15-10"><a href="mpd-summaries.html#cb15-10" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">approximate_single_year_obs =</span> T)</span>
<span id="cb15-11"><a href="mpd-summaries.html#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(weights, <span class="at">file =</span> <span class="fu">file.path</span>(working_dir, reweight_folder, <span class="st">&quot;Weights.RDS&quot;</span>))</span>
<span id="cb15-12"><a href="mpd-summaries.html#cb15-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-13"><a href="mpd-summaries.html#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="do">## get reweighted MPDs to observe the effect</span></span>
<span id="cb15-14"><a href="mpd-summaries.html#cb15-14" aria-hidden="true" tabindex="-1"></a>MPD_list <span class="ot">=</span> <span class="fu">extract_reweighted_mpds</span>(<span class="fu">file.path</span>(working_dir,reweight_folder))</span>
<span id="cb15-15"><a href="mpd-summaries.html#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="mpd-summaries.html#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="do">## plot SSBs</span></span>
<span id="cb15-17"><a href="mpd-summaries.html#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_derived_quantities</span>(MPD_list)</span>
<span id="cb15-18"><a href="mpd-summaries.html#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_fishery</span>(MPD_list, <span class="at">quantity =</span> <span class="st">&quot;exploitation&quot;</span>)</span>
<span id="cb15-19"><a href="mpd-summaries.html#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_recruitment</span>(MPD_list, <span class="at">quantity =</span> <span class="st">&quot;standardised_recruitment_multipliers&quot;</span>)</span></code></pre></div>
</div>
<div id="model-quantities" class="section level3 hasAnchor" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Model quantities<a href="mpd-summaries.html#model-quantities" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="fishing-pressures" class="section level4 unnumbered hasAnchor">
<h4>Fishing Pressures<a href="mpd-summaries.html#fishing-pressures" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Below illustrates code to plot fishing pressure, but you can also easily adapt the code to plot catches. One thing to note, is Casal2 will report both <code>exploitation_rate</code> (actual a proportion also called harvest rate) and <code>fishing_pressures</code>. For models that only have a single fishery per time-step and area these quantities will be the same. If there are multiple fisheries interacting with the partition in the same time-step then these quantities will differ. Fishing pressure is the maximum exploitation applied to the partition for that time-step. See the Casal2 user manual for more detail on the difference. <code>exploitation_rate</code> reported is just
<span class="math display">\[
\frac{catch}{vunerable}
\]</span></p>
<p>Some R-code used to summarise fishing pressures.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="mpd-summaries.html#cb16-1" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">=</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;SimpleTestModel&quot;</span>, <span class="st">&quot;estimate.log&quot;</span>, </span>
<span id="cb16-2"><a href="mpd-summaries.html#cb16-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">package =</span> <span class="st">&quot;r4Casal2&quot;</span>, <span class="at">mustWork =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-3"><a href="mpd-summaries.html#cb16-3" aria-hidden="true" tabindex="-1"></a>mpd <span class="ot">=</span> <span class="fu">extract.mpd</span>(<span class="at">file =</span> file_name)</span>
<span id="cb16-4"><a href="mpd-summaries.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Report labels</span></span>
<span id="cb16-5"><a href="mpd-summaries.html#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># names(mpd) </span></span>
<span id="cb16-6"><a href="mpd-summaries.html#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot fishing pressures</span></span>
<span id="cb16-7"><a href="mpd-summaries.html#cb16-7" aria-hidden="true" tabindex="-1"></a>fishery_info <span class="ot">=</span> <span class="fu">get_fisheries</span>(mpd)</span>
<span id="cb16-8"><a href="mpd-summaries.html#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fishery_info)</span>
<span id="cb16-9"><a href="mpd-summaries.html#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Note this will print both fishing pressure and exploitation</span></span>
<span id="cb16-10"><a href="mpd-summaries.html#cb16-10" aria-hidden="true" tabindex="-1"></a>my_plot <span class="ot">=</span> <span class="fu">ggplot</span>(fishery_info, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> exploitation, <span class="at">col =</span> fishery, <span class="at">linetype =</span> fishery)) <span class="sc">+</span></span>
<span id="cb16-11"><a href="mpd-summaries.html#cb16-11" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">geom_line</span>(<span class="at">size =</span><span class="dv">2</span>)</span>
<span id="cb16-12"><a href="mpd-summaries.html#cb16-12" aria-hidden="true" tabindex="-1"></a>my_plot</span></code></pre></div>
<p><img src="_main_files/figure-html/pressures-1.png" width="576" />
Flexibility using standard ggplot functions</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="mpd-summaries.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># you can add adjust it as you please, for example if you want 3 panels for each fishery</span></span>
<span id="cb17-2"><a href="mpd-summaries.html#cb17-2" aria-hidden="true" tabindex="-1"></a>my_plot <span class="sc">+</span> </span>
<span id="cb17-3"><a href="mpd-summaries.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>fishery) <span class="sc">+</span> </span>
<span id="cb17-4"><a href="mpd-summaries.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/pressures_alt-1.png" width="576" /></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="mpd-summaries.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust ylim and add a reference limit</span></span>
<span id="cb18-2"><a href="mpd-summaries.html#cb18-2" aria-hidden="true" tabindex="-1"></a>my_plot <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="fl">0.09</span>) <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.05</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/pressures_alt_again-1.png" width="576" />
#### SSBs {-}</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="mpd-summaries.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get SSB and recruit</span></span>
<span id="cb19-2"><a href="mpd-summaries.html#cb19-2" aria-hidden="true" tabindex="-1"></a>ssb_df <span class="ot">=</span> <span class="fu">get_dqs</span>(mpd)</span>
<span id="cb19-3"><a href="mpd-summaries.html#cb19-3" aria-hidden="true" tabindex="-1"></a>ssb_df<span class="sc">$</span>model_year <span class="ot">=</span> ssb_df<span class="sc">$</span>years</span>
<span id="cb19-4"><a href="mpd-summaries.html#cb19-4" aria-hidden="true" tabindex="-1"></a>recruit_df <span class="ot">=</span> <span class="fu">get_BH_recruitment</span>(mpd)</span>
<span id="cb19-5"><a href="mpd-summaries.html#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># merge these two data frames</span></span>
<span id="cb19-6"><a href="mpd-summaries.html#cb19-6" aria-hidden="true" tabindex="-1"></a>joint_df <span class="ot">=</span> <span class="fu">right_join</span>(<span class="at">x =</span> ssb_df, <span class="at">y =</span> recruit_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;model_year&quot;</span>, <span class="st">&quot;par_set&quot;</span>))</span>
<span id="cb19-7"><a href="mpd-summaries.html#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="do">## for multi-stock models, you will need to also join by stock id</span></span>
<span id="cb19-8"><a href="mpd-summaries.html#cb19-8" aria-hidden="true" tabindex="-1"></a>joint_df<span class="sc">$</span>percent_b0 <span class="ot">=</span> joint_df<span class="sc">$</span>values <span class="sc">/</span> joint_df<span class="sc">$</span>b0 <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb19-9"><a href="mpd-summaries.html#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="do">## plot percent B0</span></span>
<span id="cb19-10"><a href="mpd-summaries.html#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joint_df, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> percent_b0)) <span class="sc">+</span></span>
<span id="cb19-11"><a href="mpd-summaries.html#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb19-12"><a href="mpd-summaries.html#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb19-13"><a href="mpd-summaries.html#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(S[t], <span class="st">&quot; / &quot;</span>, S[<span class="dv">0</span>], <span class="st">&quot; (%)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb19-14"><a href="mpd-summaries.html#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">40</span>, <span class="at">col =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb19-15"><a href="mpd-summaries.html#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="at">x =</span> <span class="dv">1900</span>, <span class="at">y =</span> <span class="dv">40</span>, <span class="at">label =</span> <span class="st">&quot;Target&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-16"><a href="mpd-summaries.html#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">20</span>, <span class="at">col =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb19-17"><a href="mpd-summaries.html#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="at">x =</span> <span class="dv">1900</span>, <span class="at">y =</span> <span class="dv">20</span>, <span class="at">label =</span> <span class="st">&quot;Soft&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-18"><a href="mpd-summaries.html#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">10</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb19-19"><a href="mpd-summaries.html#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="at">x =</span> <span class="dv">1900</span>, <span class="at">y =</span> <span class="dv">10</span>, <span class="at">label =</span> <span class="st">&quot;Hard&quot;</span>)<span class="sc">+</span></span>
<span id="cb19-20"><a href="mpd-summaries.html#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Percent B0&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-21"><a href="mpd-summaries.html#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb19-22"><a href="mpd-summaries.html#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, </span>
<span id="cb19-23"><a href="mpd-summaries.html#cb19-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>), </span>
<span id="cb19-24"><a href="mpd-summaries.html#cb19-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb19-25"><a href="mpd-summaries.html#cb19-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>),</span>
<span id="cb19-26"><a href="mpd-summaries.html#cb19-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb19-27"><a href="mpd-summaries.html#cb19-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/ssbs-1.png" width="576" /></p>
</div>
<div id="plotting-selectivities" class="section level4 hasAnchor" number="4.1.3.1">
<h4><span class="header-section-number">4.1.3.1</span> Plotting selectivities<a href="mpd-summaries.html#plotting-selectivities" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="mpd-summaries.html#cb20-1" aria-hidden="true" tabindex="-1"></a>selectivity_df <span class="ot">=</span> <span class="fu">get_selectivities</span>(<span class="at">model =</span> mpd)</span>
<span id="cb20-2"><a href="mpd-summaries.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(selectivity_df, <span class="fu">aes</span>(<span class="at">x =</span> bin, <span class="at">y =</span> selectivity, <span class="at">col =</span> selectivity_label)) <span class="sc">+</span></span>
<span id="cb20-3"><a href="mpd-summaries.html#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb20-4"><a href="mpd-summaries.html#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>selectivity_label)</span></code></pre></div>
<p><img src="_main_files/figure-html/selectivities_mpd-1.png" width="576" />
#### Growth {-}</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="mpd-summaries.html#cb21-1" aria-hidden="true" tabindex="-1"></a>growth_df <span class="ot">=</span> <span class="fu">get_growth</span>(mpd)</span>
<span id="cb21-2"><a href="mpd-summaries.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(growth_df)</span></code></pre></div>
<pre><code>##   age year time_step cvs_by_age mean_length_at_age mean_weight_at_age
## 1   1 1975     step1        0.1            29.6178        0.000143136
## 2   2 1975     step1        0.1            44.7450        0.000555816
## 3   3 1975     step1        0.1            55.5000        0.001128550
## 4   4 1975     step1        0.1            63.8482        0.001789010
## 5   5 1975     step1        0.1            70.5854        0.002488050
## 6   6 1975     step1        0.1            76.1440        0.003192290
##              label par_set
## 1 age_length_step1       1
## 2 age_length_step1       1
## 3 age_length_step1       1
## 4 age_length_step1       1
## 5 age_length_step1       1
## 6 age_length_step1       1</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="mpd-summaries.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="do">## if time-varying or type data summaris mean length and weight by year</span></span>
<span id="cb23-2"><a href="mpd-summaries.html#cb23-2" aria-hidden="true" tabindex="-1"></a>avg_summarises <span class="ot">=</span> growth_df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(</span>
<span id="cb23-3"><a href="mpd-summaries.html#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_length =</span> <span class="fu">mean</span>(mean_length_at_age), </span>
<span id="cb23-4"><a href="mpd-summaries.html#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_weight =</span> <span class="fu">mean</span>(mean_weight_at_age))</span>
<span id="cb23-5"><a href="mpd-summaries.html#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="mpd-summaries.html#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(avg_summarises, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> mean_length)) <span class="sc">+</span></span>
<span id="cb23-7"><a href="mpd-summaries.html#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb23-8"><a href="mpd-summaries.html#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col =</span> <span class="st">&quot;gray60&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-9"><a href="mpd-summaries.html#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Mean length (cm)&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-10"><a href="mpd-summaries.html#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/growth_df-1.png" width="576" /></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="mpd-summaries.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(avg_summarises, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> mean_weight <span class="sc">*</span> <span class="dv">1000</span>)) <span class="sc">+</span></span>
<span id="cb24-2"><a href="mpd-summaries.html#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb24-3"><a href="mpd-summaries.html#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col =</span> <span class="st">&quot;gray60&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb24-4"><a href="mpd-summaries.html#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Mean weight (kg)&quot;</span>) <span class="sc">+</span></span>
<span id="cb24-5"><a href="mpd-summaries.html#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() </span></code></pre></div>
<p><img src="_main_files/figure-html/growth_df-2.png" width="576" /></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="mpd-summaries.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## if not time-varying just pick one year to plot</span></span>
<span id="cb25-2"><a href="mpd-summaries.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(growth_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1990</span>)) <span class="sc">+</span></span>
<span id="cb25-3"><a href="mpd-summaries.html#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> mean_length_at_age, <span class="at">col =</span> time_step, <span class="at">linetype =</span> time_step), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb25-4"><a href="mpd-summaries.html#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Age&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Length (cm)&quot;</span>, <span class="at">col =</span> <span class="st">&quot;Time-step&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/growth_by_time_step_df-1.png" width="576" /></p>
</div>
</div>
<div id="plotting-fits" class="section level3 hasAnchor" number="4.1.4">
<h3><span class="header-section-number">4.1.4</span> Plotting Fits<a href="mpd-summaries.html#plotting-fits" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="relative-abundance" class="section level4 unnumbered hasAnchor">
<h4>Relative abundance<a href="mpd-summaries.html#relative-abundance" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="mpd-summaries.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">## define a palette</span></span>
<span id="cb26-2"><a href="mpd-summaries.html#cb26-2" aria-hidden="true" tabindex="-1"></a>obs_pallete <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>,<span class="st">&quot;#009E73&quot;</span>)</span>
<span id="cb26-3"><a href="mpd-summaries.html#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(obs_pallete) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Observed&quot;</span>, <span class="st">&quot;Predicted&quot;</span>,<span class="st">&quot;Pearson&#39;s Residuals&quot;</span>)</span>
<span id="cb26-4"><a href="mpd-summaries.html#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="do">## get abundance data frames</span></span>
<span id="cb26-5"><a href="mpd-summaries.html#cb26-5" aria-hidden="true" tabindex="-1"></a>abundance_obs <span class="ot">=</span> <span class="fu">get_abundance_observations</span>(mpd)</span>
<span id="cb26-6"><a href="mpd-summaries.html#cb26-6" aria-hidden="true" tabindex="-1"></a>abundance_obs_label <span class="ot">=</span> <span class="fu">unique</span>((abundance_obs<span class="sc">$</span>observation_label))</span>
<span id="cb26-7"><a href="mpd-summaries.html#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="mpd-summaries.html#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="do">## plot observed vs fitted</span></span>
<span id="cb26-9"><a href="mpd-summaries.html#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(abundance_obs, <span class="fu">aes</span>(<span class="at">x =</span> year)) <span class="sc">+</span></span>
<span id="cb26-10"><a href="mpd-summaries.html#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> expected, <span class="at">col =</span> <span class="st">&quot;Predicted&quot;</span>), <span class="at">size =</span> <span class="fl">1.2</span>, </span>
<span id="cb26-11"><a href="mpd-summaries.html#cb26-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb26-12"><a href="mpd-summaries.html#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> expected, <span class="at">col =</span> <span class="st">&quot;Predicted&quot;</span>), <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb26-13"><a href="mpd-summaries.html#cb26-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> L_CI, <span class="at">ymax =</span> U_CI, <span class="at">col =</span> <span class="st">&quot;Observed&quot;</span>), </span>
<span id="cb26-14"><a href="mpd-summaries.html#cb26-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">width=</span>.<span class="dv">5</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.9</span>)) <span class="sc">+</span></span>
<span id="cb26-15"><a href="mpd-summaries.html#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> observed, <span class="at">col =</span> <span class="st">&quot;Observed&quot;</span>), <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb26-16"><a href="mpd-summaries.html#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Relative index&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb26-17"><a href="mpd-summaries.html#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb26-18"><a href="mpd-summaries.html#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb26-19"><a href="mpd-summaries.html#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>observation_label, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb26-20"><a href="mpd-summaries.html#cb26-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, </span>
<span id="cb26-21"><a href="mpd-summaries.html#cb26-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>), </span>
<span id="cb26-22"><a href="mpd-summaries.html#cb26-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb26-23"><a href="mpd-summaries.html#cb26-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>),</span>
<span id="cb26-24"><a href="mpd-summaries.html#cb26-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb26-25"><a href="mpd-summaries.html#cb26-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> obs_pallete[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span></code></pre></div>
<p><img src="_main_files/figure-html/plot_relative_index-1.png" width="768" /></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="mpd-summaries.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot pearsons residuals</span></span>
<span id="cb27-2"><a href="mpd-summaries.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(abundance_obs, <span class="fu">aes</span>(<span class="at">x =</span> year)) <span class="sc">+</span></span>
<span id="cb27-3"><a href="mpd-summaries.html#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> pearsons_residuals, <span class="at">col =</span> <span class="st">&quot;Pearson&#39;s Residuals&quot;</span>), </span>
<span id="cb27-4"><a href="mpd-summaries.html#cb27-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb27-5"><a href="mpd-summaries.html#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> pearsons_residuals, <span class="at">col =</span> <span class="st">&quot;Pearson&#39;s Residuals&quot;</span>, </span>
<span id="cb27-6"><a href="mpd-summaries.html#cb27-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="st">&quot;Pearson&#39;s Residuals&quot;</span>), <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>,</span>
<span id="cb27-7"><a href="mpd-summaries.html#cb27-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-8"><a href="mpd-summaries.html#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Age&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Pearson&#39;s Residuals&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;&quot;</span>, <span class="at">col =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-9"><a href="mpd-summaries.html#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">&quot;#999999&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, </span>
<span id="cb27-10"><a href="mpd-summaries.html#cb27-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb27-11"><a href="mpd-summaries.html#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>), <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, </span>
<span id="cb27-12"><a href="mpd-summaries.html#cb27-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span> </span>
<span id="cb27-13"><a href="mpd-summaries.html#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>observation_label, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb27-14"><a href="mpd-summaries.html#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ylim(3,-3) +</span></span>
<span id="cb27-15"><a href="mpd-summaries.html#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb27-16"><a href="mpd-summaries.html#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>observation_label, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-17"><a href="mpd-summaries.html#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, </span>
<span id="cb27-18"><a href="mpd-summaries.html#cb27-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>), </span>
<span id="cb27-19"><a href="mpd-summaries.html#cb27-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb27-20"><a href="mpd-summaries.html#cb27-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>),</span>
<span id="cb27-21"><a href="mpd-summaries.html#cb27-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>)),</span>
<span id="cb27-22"><a href="mpd-summaries.html#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> obs_pallete[<span class="dv">3</span>]),</span>
<span id="cb27-23"><a href="mpd-summaries.html#cb27-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> obs_pallete[<span class="dv">3</span>]))</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="_main_files/figure-html/plot_resid_index-1.png" width="768" /></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="mpd-summaries.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="do">## complete a Wald-Wolfowitz Runs Test</span></span>
<span id="cb29-2"><a href="mpd-summaries.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="do">## are residuals a random sequence</span></span>
<span id="cb29-3"><a href="mpd-summaries.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">runs_test_residuals</span>(abundance_obs<span class="sc">$</span>pearsons_residuals)</span></code></pre></div>
<pre><code>## $siglim
## [1] -2.340038  2.340038
## 
## $p.runs
## [1] 0.556</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="mpd-summaries.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="do">## seem fine i.e. not rejecting Null hypothesis </span></span>
<span id="cb31-2"><a href="mpd-summaries.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="do">## H0: &quot;The order of the data is random &quot;</span></span></code></pre></div>
</div>
<div id="age-composition" class="section level4 unnumbered hasAnchor">
<h4>Age composition<a href="mpd-summaries.html#age-composition" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="mpd-summaries.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="do">## define a palette</span></span>
<span id="cb32-2"><a href="mpd-summaries.html#cb32-2" aria-hidden="true" tabindex="-1"></a>comp_obs <span class="ot">=</span> <span class="fu">get_composition_observations</span>(mpd)</span>
<span id="cb32-3"><a href="mpd-summaries.html#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(comp_obs<span class="sc">$</span>observation_label)</span></code></pre></div>
<pre><code>## [1] &quot;chatTANage&quot; &quot;chatOBSwst&quot; &quot;chatOBSest&quot;</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="mpd-summaries.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="do">## just plot one of them</span></span>
<span id="cb34-2"><a href="mpd-summaries.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="do">## and the first 12 years</span></span>
<span id="cb34-3"><a href="mpd-summaries.html#cb34-3" aria-hidden="true" tabindex="-1"></a>this_obs <span class="ot">=</span> comp_obs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(observation_label <span class="sc">==</span> <span class="st">&quot;chatTANage&quot;</span>)</span>
<span id="cb34-4"><a href="mpd-summaries.html#cb34-4" aria-hidden="true" tabindex="-1"></a>years_to_plot <span class="ot">=</span> <span class="fu">unique</span>(this_obs<span class="sc">$</span>year)[<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>]</span>
<span id="cb34-5"><a href="mpd-summaries.html#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="do">## calcualte effective N for plot</span></span>
<span id="cb34-6"><a href="mpd-summaries.html#cb34-6" aria-hidden="true" tabindex="-1"></a>this_obs <span class="ot">=</span> this_obs <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(year, observation_label) <span class="sc">%&gt;%</span> </span>
<span id="cb34-7"><a href="mpd-summaries.html#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Nassumed =</span> <span class="fu">mean</span>(adjusted_error))</span>
<span id="cb34-8"><a href="mpd-summaries.html#cb34-8" aria-hidden="true" tabindex="-1"></a>  this_obs<span class="sc">$</span>label <span class="ot">=</span> <span class="fu">paste0</span>(this_obs<span class="sc">$</span>year, <span class="st">&quot; N = &quot;</span>, <span class="fu">round</span>(this_obs<span class="sc">$</span>Nassumed,<span class="dv">1</span>))</span>
<span id="cb34-9"><a href="mpd-summaries.html#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="mpd-summaries.html#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(this_obs, <span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb34-11"><a href="mpd-summaries.html#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> expected, <span class="at">col =</span> <span class="st">&quot;Predicted&quot;</span>), <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb34-12"><a href="mpd-summaries.html#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> observed, <span class="at">col =</span> <span class="st">&quot;Observed&quot;</span>), <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb34-13"><a href="mpd-summaries.html#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Age&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Proportions&quot;</span>) <span class="sc">+</span></span>
<span id="cb34-14"><a href="mpd-summaries.html#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>label, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb34-15"><a href="mpd-summaries.html#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;chatTANage&quot;</span>) <span class="sc">+</span></span>
<span id="cb34-16"><a href="mpd-summaries.html#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb34-17"><a href="mpd-summaries.html#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, </span>
<span id="cb34-18"><a href="mpd-summaries.html#cb34-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>), </span>
<span id="cb34-19"><a href="mpd-summaries.html#cb34-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb34-20"><a href="mpd-summaries.html#cb34-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>),</span>
<span id="cb34-21"><a href="mpd-summaries.html#cb34-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb34-22"><a href="mpd-summaries.html#cb34-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> obs_pallete[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span></code></pre></div>
<p><img src="_main_files/figure-html/plot_comp_fit-1.png" width="960" /></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="mpd-summaries.html#cb35-1" aria-hidden="true" tabindex="-1"></a>mean_age_df <span class="ot">=</span> <span class="fu">get_composition_mean_bin</span>(mpd)</span>
<span id="cb35-2"><a href="mpd-summaries.html#cb35-2" aria-hidden="true" tabindex="-1"></a>n_obs <span class="ot">=</span> <span class="fu">unique</span>(mean_age_df<span class="sc">$</span>observation_label)</span>
<span id="cb35-3"><a href="mpd-summaries.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="do">## create a nice plot with seperate axis</span></span>
<span id="cb35-4"><a href="mpd-summaries.html#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mean_age_df, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">col =</span> observation_label)) <span class="sc">+</span></span>
<span id="cb35-5"><a href="mpd-summaries.html#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Oy<span class="dv">-2</span><span class="sc">*</span>SEy, <span class="at">ymax =</span> Oy <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SEy), <span class="at">width=</span>.<span class="dv">5</span>, </span>
<span id="cb35-6"><a href="mpd-summaries.html#cb35-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width=</span><span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb35-7"><a href="mpd-summaries.html#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Oy), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.9</span>)) <span class="sc">+</span></span>
<span id="cb35-8"><a href="mpd-summaries.html#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Ey), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb35-9"><a href="mpd-summaries.html#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Years&quot;</span>,<span class="at">y =</span> <span class="st">&quot;Mean age (+- 2 SE)&quot;</span>) <span class="sc">+</span></span>
<span id="cb35-10"><a href="mpd-summaries.html#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>observation_label, <span class="at">nrow =</span> <span class="fu">length</span>(n_obs))  <span class="sc">+</span></span>
<span id="cb35-11"><a href="mpd-summaries.html#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, </span>
<span id="cb35-12"><a href="mpd-summaries.html#cb35-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>), </span>
<span id="cb35-13"><a href="mpd-summaries.html#cb35-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb35-14"><a href="mpd-summaries.html#cb35-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>),</span>
<span id="cb35-15"><a href="mpd-summaries.html#cb35-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/plot_mean_age_fit-1.png" width="960" /></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="mpd-summaries.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="do">## a nice plot with overlapping mean age</span></span>
<span id="cb36-2"><a href="mpd-summaries.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mean_age_df, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">col =</span> observation_label)) <span class="sc">+</span></span>
<span id="cb36-3"><a href="mpd-summaries.html#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Oy<span class="dv">-2</span><span class="sc">*</span>SEy, <span class="at">ymax =</span> Oy <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>SEy), <span class="at">width=</span>.<span class="dv">5</span>, </span>
<span id="cb36-4"><a href="mpd-summaries.html#cb36-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.9</span>)) <span class="sc">+</span></span>
<span id="cb36-5"><a href="mpd-summaries.html#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Oy), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.9</span>)) <span class="sc">+</span></span>
<span id="cb36-6"><a href="mpd-summaries.html#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Ey), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb36-7"><a href="mpd-summaries.html#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Years&quot;</span>,<span class="at">y =</span> <span class="st">&quot;Mean age (+- 2 SE)&quot;</span>) <span class="sc">+</span></span>
<span id="cb36-8"><a href="mpd-summaries.html#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb36-9"><a href="mpd-summaries.html#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>, </span>
<span id="cb36-10"><a href="mpd-summaries.html#cb36-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>), </span>
<span id="cb36-11"><a href="mpd-summaries.html#cb36-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb36-12"><a href="mpd-summaries.html#cb36-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>),</span>
<span id="cb36-13"><a href="mpd-summaries.html#cb36-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/plot_mean_age_fit-2.png" width="960" /></p>
</div>
</div>
</div>
<div id="multiple-casal2-runs-with--i-or--s" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Multiple Casal2 runs with -i or -s<a href="mpd-summaries.html#multiple-casal2-runs-with--i-or--s" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="mpd-summaries.html#cb37-1" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">=</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;SimpleTestModel&quot;</span>,<span class="st">&quot;multi_run.log&quot;</span>, </span>
<span id="cb37-2"><a href="mpd-summaries.html#cb37-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">package =</span> <span class="st">&quot;r4Casal2&quot;</span>, <span class="at">mustWork =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-3"><a href="mpd-summaries.html#cb37-3" aria-hidden="true" tabindex="-1"></a>mpd <span class="ot">=</span> <span class="fu">extract.mpd</span>(<span class="at">file =</span> file_name)</span>
<span id="cb37-4"><a href="mpd-summaries.html#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Report labels</span></span>
<span id="cb37-5"><a href="mpd-summaries.html#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># names(mpd) </span></span>
<span id="cb37-6"><a href="mpd-summaries.html#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot fishing pressures</span></span>
<span id="cb37-7"><a href="mpd-summaries.html#cb37-7" aria-hidden="true" tabindex="-1"></a>fishery_df <span class="ot">=</span> <span class="fu">get_fisheries</span>(<span class="at">model =</span> mpd)</span>
<span id="cb37-8"><a href="mpd-summaries.html#cb37-8" aria-hidden="true" tabindex="-1"></a>my_plot <span class="ot">=</span> <span class="fu">ggplot</span>(fishery_df, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> exploitation, <span class="at">col =</span> <span class="fu">factor</span>(par_set))) <span class="sc">+</span></span>
<span id="cb37-9"><a href="mpd-summaries.html#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.4</span>) <span class="sc">+</span></span>
<span id="cb37-10"><a href="mpd-summaries.html#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>fishery)</span>
<span id="cb37-11"><a href="mpd-summaries.html#cb37-11" aria-hidden="true" tabindex="-1"></a>my_plot <span class="ot">=</span> my_plot <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>))</span>
<span id="cb37-12"><a href="mpd-summaries.html#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co"># this will generate a generic ggplot</span></span>
<span id="cb37-13"><a href="mpd-summaries.html#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_plot)</span></code></pre></div>
<p><img src="_main_files/figure-html/pressures_multi-1.png" width="576" /></p>
<div id="plotting-selectivities-1" class="section level3 unnumbered hasAnchor">
<h3>Plotting selectivities<a href="mpd-summaries.html#plotting-selectivities-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="mpd-summaries.html#cb38-1" aria-hidden="true" tabindex="-1"></a>selectivity_df <span class="ot">=</span> <span class="fu">get_selectivities</span>(mpd)</span>
<span id="cb38-2"><a href="mpd-summaries.html#cb38-2" aria-hidden="true" tabindex="-1"></a>selectivity_df<span class="sc">$</span>par_set <span class="ot">=</span> <span class="fu">factor</span>(selectivity_df<span class="sc">$</span>par_set, <span class="at">ordered =</span> T)</span>
<span id="cb38-3"><a href="mpd-summaries.html#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(selectivity_df, <span class="fu">aes</span>(<span class="at">x =</span> bin, <span class="at">y =</span> selectivity, <span class="at">col =</span> selectivity_label, <span class="at">line_type =</span> par_set)) <span class="sc">+</span></span>
<span id="cb38-4"><a href="mpd-summaries.html#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb38-5"><a href="mpd-summaries.html#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(par_set <span class="sc">~</span> selectivity_label)</span></code></pre></div>
<p><img src="_main_files/figure-html/selectivities_multi-1.png" width="768" /></p>
</div>
<div id="plotting-fits-1" class="section level3 unnumbered hasAnchor">
<h3>Plotting Fits<a href="mpd-summaries.html#plotting-fits-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="mpd-summaries.html#cb39-1" aria-hidden="true" tabindex="-1"></a>my_plot <span class="ot">=</span> <span class="fu">plot_relative_index</span>(<span class="at">model =</span> mpd, <span class="at">report_labels =</span> <span class="fu">c</span>(<span class="st">&quot;chatTANbiomass&quot;</span>), <span class="at">plot.it =</span> T, <span class="at">plot_type =</span> <span class="st">&quot;classic&quot;</span>)</span>
<span id="cb39-2"><a href="mpd-summaries.html#cb39-2" aria-hidden="true" tabindex="-1"></a>my_plot</span></code></pre></div>
<p><img src="_main_files/figure-html/plot_relative_index_multi-1.png" width="768" /></p>

</div>
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-CARVALHO2021105959" class="csl-entry">
Carvalho, Felipe, Henning Winker, Dean Courtney, Maia Kapur, Laurence Kell, Massimiliano Cardinale, Michael Schirripa, et al. 2021. <span>“A Cookbook for Using Model Diagnostics in Integrated Stock Assessments.”</span> <em>Fisheries Research</em> 240: 105959. https://doi.org/<a href="https://doi.org/10.1016/j.fishres.2021.105959">https://doi.org/10.1016/j.fishres.2021.105959</a>.
</div>
<div id="ref-francis2011data" class="csl-entry">
Francis, RIC Chris. 2011. <span>“Data Weighting in Statistical Fisheries Stock Assessment Models.”</span> <em>Canadian Journal of Fisheries and Aquatic Sciences</em> 68 (6): 1124–38.
</div>
<div id="ref-MINTEVERA2017114" class="csl-entry">
Minte-Vera, Carolina V., Mark N. Maunder, Alexandre M. Aires-da-Silva, Keisuke Satoh, and Koji Uosaki. 2017. <span>“Get the Biology Right, or Use Size-Composition Data at Your Own Risk.”</span> <em>Fisheries Research</em> 192: 114–25.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="summariseinputs.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="summarisemultipleinputs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/NIWAFisheriesModelling/r4Casal2/edit/main/03-MPD.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
