<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 MPD summaries | r4Casal2</title>
  <meta name="description" content="This book demonstrates how to use r4Casal2 to make your Casal2 experience better." />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 MPD summaries | r4Casal2" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This book demonstrates how to use r4Casal2 to make your Casal2 experience better." />
  <meta name="github-repo" content="https://github.com/NIWAFisheriesModelling/r4Casal2" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 MPD summaries | r4Casal2" />
  
  <meta name="twitter:description" content="This book demonstrates how to use r4Casal2 to make your Casal2 experience better." />
  

<meta name="author" content="C.Marsh" />


<meta name="date" content="2022-07-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="summariseinputs.html"/>
<link rel="next" href="summarisemultipleinputs.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">r4Casal2</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcolme to <strong>r4Casal2</strong></a></li>
<li class="chapter" data-level="2" data-path="functionlist.html"><a href="functionlist.html"><i class="fa fa-check"></i><b>2</b> A list of key functions in the <code>r4Casal2</code> package</a>
<ul>
<li class="chapter" data-level="2.1" data-path="functionlist.html"><a href="functionlist.html#accessor-functions"><i class="fa fa-check"></i><b>2.1</b> Accessor functions</a></li>
<li class="chapter" data-level="2.2" data-path="functionlist.html"><a href="functionlist.html#other-useful-functions"><i class="fa fa-check"></i><b>2.2</b> Other useful functions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="summariseinputs.html"><a href="summariseinputs.html"><i class="fa fa-check"></i><b>3</b> Summarise configuration inputs</a>
<ul>
<li class="chapter" data-level="3.1" data-path="summariseinputs.html"><a href="summariseinputs.html#example-files"><i class="fa fa-check"></i><b>3.1</b> Example files</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mpd-summaries.html"><a href="mpd-summaries.html"><i class="fa fa-check"></i><b>4</b> MPD summaries</a>
<ul>
<li class="chapter" data-level="4.1" data-path="mpd-summaries.html"><a href="mpd-summaries.html#single-model-output"><i class="fa fa-check"></i><b>4.1</b> Single Model Output</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="mpd-summaries.html"><a href="mpd-summaries.html#model-convergence"><i class="fa fa-check"></i><b>4.1.1</b> Model Convergence</a></li>
<li class="chapter" data-level="4.1.2" data-path="mpd-summaries.html"><a href="mpd-summaries.html#data-weighting"><i class="fa fa-check"></i><b>4.1.2</b> Data Weighting</a></li>
<li class="chapter" data-level="4.1.3" data-path="mpd-summaries.html"><a href="mpd-summaries.html#model-quantities"><i class="fa fa-check"></i><b>4.1.3</b> Model quantities</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="mpd-summaries.html"><a href="mpd-summaries.html#multiple-casal2-runs-with--i-or--s"><i class="fa fa-check"></i><b>4.2</b> Multiple Casal2 runs with -i or -s</a>
<ul>
<li class="chapter" data-level="" data-path="mpd-summaries.html"><a href="mpd-summaries.html#plotting-selectivities-1"><i class="fa fa-check"></i>Plotting selectivities</a></li>
<li class="chapter" data-level="" data-path="mpd-summaries.html"><a href="mpd-summaries.html#plotting-fits"><i class="fa fa-check"></i>Plotting Fits</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="summarisemultipleinputs.html"><a href="summarisemultipleinputs.html"><i class="fa fa-check"></i><b>5</b> Comparing multiple MPD runs</a>
<ul>
<li class="chapter" data-level="5.1" data-path="summarisemultipleinputs.html"><a href="summarisemultipleinputs.html#read-in-models"><i class="fa fa-check"></i><b>5.1</b> Read in models</a></li>
<li class="chapter" data-level="5.2" data-path="summarisemultipleinputs.html"><a href="summarisemultipleinputs.html#compare-model-outputs"><i class="fa fa-check"></i><b>5.2</b> Compare model outputs</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="summarisemultipleinputs.html"><a href="summarisemultipleinputs.html#selectivities"><i class="fa fa-check"></i><b>5.2.1</b> selectivities</a></li>
<li class="chapter" data-level="5.2.2" data-path="summarisemultipleinputs.html"><a href="summarisemultipleinputs.html#derived-quantities"><i class="fa fa-check"></i><b>5.2.2</b> Derived quantities</a></li>
<li class="chapter" data-level="5.2.3" data-path="summarisemultipleinputs.html"><a href="summarisemultipleinputs.html#recruitment"><i class="fa fa-check"></i><b>5.2.3</b> Recruitment</a></li>
<li class="chapter" data-level="5.2.4" data-path="summarisemultipleinputs.html"><a href="summarisemultipleinputs.html#abundance-fits"><i class="fa fa-check"></i><b>5.2.4</b> Abundance fits</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mcmc.html"><a href="mcmc.html"><i class="fa fa-check"></i><b>6</b> MCMC</a>
<ul>
<li class="chapter" data-level="6.1" data-path="mcmc.html"><a href="mcmc.html#read-in-models-1"><i class="fa fa-check"></i><b>6.1</b> Read in models</a></li>
<li class="chapter" data-level="6.2" data-path="mcmc.html"><a href="mcmc.html#diagnostics"><i class="fa fa-check"></i><b>6.2</b> Diagnostics</a></li>
<li class="chapter" data-level="6.3" data-path="mcmc.html"><a href="mcmc.html#plotting-quantities"><i class="fa fa-check"></i><b>6.3</b> Plotting quantities</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="mcmc.html"><a href="mcmc.html#selectivities-1"><i class="fa fa-check"></i><b>6.3.1</b> selectivities</a></li>
<li class="chapter" data-level="6.3.2" data-path="mcmc.html"><a href="mcmc.html#derived-quantities-1"><i class="fa fa-check"></i><b>6.3.2</b> Derived quantities</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="PPC.html"><a href="PPC.html"><i class="fa fa-check"></i><b>7</b> Posterior Predictive Checks</a>
<ul>
<li class="chapter" data-level="7.1" data-path="PPC.html"><a href="PPC.html#introduction"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="PPC.html"><a href="PPC.html#estimation"><i class="fa fa-check"></i><b>7.2</b> Estimation</a></li>
<li class="chapter" data-level="7.3" data-path="PPC.html"><a href="PPC.html#simulations"><i class="fa fa-check"></i><b>7.3</b> Simulations</a></li>
<li class="chapter" data-level="7.4" data-path="PPC.html"><a href="PPC.html#summarising-simulated-data-in-r"><i class="fa fa-check"></i><b>7.4</b> Summarising simulated data in R</a></li>
<li class="chapter" data-level="7.5" data-path="PPC.html"><a href="PPC.html#posterior-predictive-checks"><i class="fa fa-check"></i><b>7.5</b> Posterior predictive checks</a></li>
<li class="chapter" data-level="7.6" data-path="PPC.html"><a href="PPC.html#pit-residuals"><i class="fa fa-check"></i><b>7.6</b> PIT residuals</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="presentwithBookdown.html"><a href="presentwithBookdown.html"><i class="fa fa-check"></i><b>8</b> Presenting Models using Bookdown</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/NIWAFisheriesModelling/r4Casal2" target="blank">Github Repo here</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">r4Casal2</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mpd-summaries" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> MPD summaries<a href="mpd-summaries.html#mpd-summaries" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="single-model-output" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Single Model Output<a href="mpd-summaries.html#single-model-output" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="mpd-summaries.html#cb10-1" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">=</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>,<span class="st">&quot;SimpleTestModel&quot;</span>, </span>
<span id="cb10-2"><a href="mpd-summaries.html#cb10-2" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;estimate.log&quot;</span>, <span class="at">package =</span> <span class="st">&quot;r4Casal2&quot;</span>, <span class="at">mustWork =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-3"><a href="mpd-summaries.html#cb10-3" aria-hidden="true" tabindex="-1"></a>mpd <span class="ot">=</span> <span class="fu">extract.mpd</span>(<span class="at">file =</span> file_name)</span></code></pre></div>
<div id="model-convergence" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Model Convergence<a href="mpd-summaries.html#model-convergence" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are a range of appproaches for checking your model has converged. The approaches we will be working through include checking the hessian is positive definite, checking parameters are not running to bounds and reestimate with random starting locations.</p>
<p>When estimating models in Casal2, it is recommended to have the following report included</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="mpd-summaries.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">@report</span> covariance_matrix</span>
<span id="cb11-2"><a href="mpd-summaries.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span> covariance_matrix</span>
<span id="cb11-3"><a href="mpd-summaries.html#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">## or the Hessian</span></span>
<span id="cb11-4"><a href="mpd-summaries.html#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="ex">@report</span> hessian_matrix</span>
<span id="cb11-5"><a href="mpd-summaries.html#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span> hessian_matrix</span></code></pre></div>
<p>When estimation is complete and you have read in the Casal2 output using <code>Casal2::extract.mpd()</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="mpd-summaries.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># file name</span></span>
<span id="cb12-2"><a href="mpd-summaries.html#cb12-2" aria-hidden="true" tabindex="-1"></a>mpd_file_name <span class="ot">=</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;PosteriorPredictiveChecks&quot;</span>,<span class="st">&quot;estimate.log&quot;</span>, </span>
<span id="cb12-3"><a href="mpd-summaries.html#cb12-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">package =</span> <span class="st">&quot;r4Casal2&quot;</span>, <span class="at">mustWork =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-4"><a href="mpd-summaries.html#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># read in output</span></span>
<span id="cb12-5"><a href="mpd-summaries.html#cb12-5" aria-hidden="true" tabindex="-1"></a>mpd <span class="ot">=</span> <span class="fu">extract.mpd</span>(<span class="at">file =</span> mpd_file_name)</span>
<span id="cb12-6"><a href="mpd-summaries.html#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># is covariance symetric</span></span>
<span id="cb12-7"><a href="mpd-summaries.html#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">isSymmetric</span>(mpd<span class="sc">$</span>covar<span class="sc">$</span>covariance_matrix)</span>
<span id="cb12-8"><a href="mpd-summaries.html#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># is hessian invertable</span></span>
<span id="cb12-9"><a href="mpd-summaries.html#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">is_matrix_invertable</span>(mpd<span class="sc">$</span>hess<span class="sc">$</span>hessian_matrix)</span></code></pre></div>
<p>Once these are satisfied you will have more confidence in your standard errors, in addition to being able to run MCMC run mode.</p>
<p>Another useful convergence diagnostic is re-estimating Casal2 at difference starting locations. The function used for this is <code>?generate.starting.pars</code>. This will read a Casal2 config file that contains all the <code>@estimate</code> definitions are generate a bunch of random starting values in the format of useable for <code>-i</code> in Casal2.</p>
</div>
<div id="data-weighting" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Data Weighting<a href="mpd-summaries.html#data-weighting" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Some pseudo r code to help with data weighting according to <span class="citation">Francis (<a href="#ref-francis2011data" role="doc-biblioref">2011</a>)</span> with multinomial data.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="mpd-summaries.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb13-2"><a href="mpd-summaries.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; This is an example which includes some R-code that will apply Francis Method TA 1.8 method</span></span>
<span id="cb13-3"><a href="mpd-summaries.html#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; and automatically update a Casal2 estimation file</span></span>
<span id="cb13-4"><a href="mpd-summaries.html#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="mpd-summaries.html#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Casal2)</span>
<span id="cb13-6"><a href="mpd-summaries.html#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(r4Casal2)</span>
<span id="cb13-7"><a href="mpd-summaries.html#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb13-8"><a href="mpd-summaries.html#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb13-9"><a href="mpd-summaries.html#cb13-9" aria-hidden="true" tabindex="-1"></a>csl_dir <span class="ot">=</span> <span class="fu">normalizePath</span>(<span class="fu">file.path</span>(<span class="st">&quot;misc&quot;</span>, <span class="st">&quot;AutomateDataWeighting&quot;</span>,<span class="st">&quot;csls&quot;</span>))</span>
<span id="cb13-10"><a href="mpd-summaries.html#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="mpd-summaries.html#cb13-11" aria-hidden="true" tabindex="-1"></a>mpd <span class="ot">=</span> <span class="fu">extract.mpd</span>(<span class="at">file =</span> <span class="st">&quot;estimate.log&quot;</span>, <span class="at">path =</span> csl_dir)</span>
<span id="cb13-12"><a href="mpd-summaries.html#cb13-12" aria-hidden="true" tabindex="-1"></a>obs_csl2 <span class="ot">=</span> <span class="fu">extract.csl2.file</span>(<span class="at">file =</span> <span class="st">&quot;Observation.csl2&quot;</span>, <span class="at">path =</span> csl_dir)</span>
<span id="cb13-13"><a href="mpd-summaries.html#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="mpd-summaries.html#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mpd)</span>
<span id="cb13-15"><a href="mpd-summaries.html#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="mpd-summaries.html#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="do">## comp labels</span></span>
<span id="cb13-17"><a href="mpd-summaries.html#cb13-17" aria-hidden="true" tabindex="-1"></a>comp_labels <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;chatTANage&quot;</span>, <span class="st">&quot;chatOBSwst&quot;</span>, <span class="st">&quot;chatOBSest&quot;</span>)</span>
<span id="cb13-18"><a href="mpd-summaries.html#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="do">## check weights</span></span>
<span id="cb13-19"><a href="mpd-summaries.html#cb13-19" aria-hidden="true" tabindex="-1"></a>max_tolerance <span class="ot">=</span> <span class="fu">abs</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">Method.TA1.8</span>(<span class="at">model =</span> mpd, <span class="at">observation_labels =</span> comp_labels, <span class="at">plot.it =</span> F))</span>
<span id="cb13-20"><a href="mpd-summaries.html#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="mpd-summaries.html#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Before running this it always pays to save a copy of the original Observation.csl2</span></span>
<span id="cb13-22"><a href="mpd-summaries.html#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="co"># incase an error occurs and deletes the file or something silly</span></span>
<span id="cb13-23"><a href="mpd-summaries.html#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="do">## run this line of code</span></span>
<span id="cb13-24"><a href="mpd-summaries.html#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="cn">FALSE</span>)</span>
<span id="cb13-25"><a href="mpd-summaries.html#cb13-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.copy</span>(<span class="at">from =</span> <span class="fu">file.path</span>(csl_dir, <span class="st">&quot;Observation.csl2&quot;</span>), </span>
<span id="cb13-26"><a href="mpd-summaries.html#cb13-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">to =</span> <span class="fu">file.path</span>(csl_dir, <span class="st">&quot;Observation_original.csl2&quot;</span>))</span>
<span id="cb13-27"><a href="mpd-summaries.html#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="mpd-summaries.html#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="co"># first run an estimation</span></span>
<span id="cb13-29"><a href="mpd-summaries.html#cb13-29" aria-hidden="true" tabindex="-1"></a>current_dir <span class="ot">=</span> <span class="fu">getwd</span>()</span>
<span id="cb13-30"><a href="mpd-summaries.html#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(csl_dir)</span>
<span id="cb13-31"><a href="mpd-summaries.html#cb13-31" aria-hidden="true" tabindex="-1"></a><span class="fu">system2</span>(<span class="at">command =</span> <span class="st">&quot;casal2&quot;</span>, <span class="at">args =</span> <span class="st">&quot;-e&quot;</span>, <span class="at">stdout =</span> <span class="fu">paste0</span>(<span class="st">&quot;estimate_&quot;</span>,<span class="dv">0</span>,<span class="st">&quot;.log&quot;</span>), <span class="at">stderr =</span> <span class="st">&quot;estimate.err&quot;</span>)</span>
<span id="cb13-32"><a href="mpd-summaries.html#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(current_dir)</span>
<span id="cb13-33"><a href="mpd-summaries.html#cb13-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-34"><a href="mpd-summaries.html#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="co"># to be even more sure, it pays to change the config.csl2 to work off !include with a different file.</span></span>
<span id="cb13-35"><a href="mpd-summaries.html#cb13-35" aria-hidden="true" tabindex="-1"></a>weighting_iterator <span class="ot">=</span> <span class="dv">1</span>;</span>
<span id="cb13-36"><a href="mpd-summaries.html#cb13-36" aria-hidden="true" tabindex="-1"></a>weighted_mpds <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb13-37"><a href="mpd-summaries.html#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(max_tolerance <span class="sc">&gt;</span> <span class="fl">0.01</span>) {</span>
<span id="cb13-38"><a href="mpd-summaries.html#cb13-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;weighting loop index = &quot;</span>, weighting_iterator, <span class="st">&quot; max tolerance = &quot;</span>, max_tolerance, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb13-39"><a href="mpd-summaries.html#cb13-39" aria-hidden="true" tabindex="-1"></a>  <span class="do">## change observation.csl2</span></span>
<span id="cb13-40"><a href="mpd-summaries.html#cb13-40" aria-hidden="true" tabindex="-1"></a>  obs_csl2 <span class="ot">=</span> <span class="fu">extract.csl2.file</span>(<span class="at">file =</span> <span class="st">&quot;Observation.csl2&quot;</span>, <span class="at">path =</span> csl_dir, <span class="at">quiet =</span> T)</span>
<span id="cb13-41"><a href="mpd-summaries.html#cb13-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># read in mpd</span></span>
<span id="cb13-42"><a href="mpd-summaries.html#cb13-42" aria-hidden="true" tabindex="-1"></a>  mpd <span class="ot">=</span> <span class="fu">extract.mpd</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;estimate_&quot;</span>,weighting_iterator <span class="sc">-</span> <span class="dv">1</span>,<span class="st">&quot;.log&quot;</span>), <span class="at">path =</span> csl_dir)</span>
<span id="cb13-43"><a href="mpd-summaries.html#cb13-43" aria-hidden="true" tabindex="-1"></a>  weighted_mpds[[<span class="fu">as.character</span>(<span class="fu">round</span>(max_tolerance,<span class="dv">3</span>))]] <span class="ot">=</span> mpd</span>
<span id="cb13-44"><a href="mpd-summaries.html#cb13-44" aria-hidden="true" tabindex="-1"></a>  vals <span class="ot">=</span> <span class="fu">vector</span>();</span>
<span id="cb13-45"><a href="mpd-summaries.html#cb13-45" aria-hidden="true" tabindex="-1"></a>  <span class="do">## loop over each comp data set and weight individually</span></span>
<span id="cb13-46"><a href="mpd-summaries.html#cb13-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(comp_ndx <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(comp_labels)) {</span>
<span id="cb13-47"><a href="mpd-summaries.html#cb13-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate weight</span></span>
<span id="cb13-48"><a href="mpd-summaries.html#cb13-48" aria-hidden="true" tabindex="-1"></a>    weight <span class="ot">=</span> <span class="fu">Method.TA1.8</span>(<span class="at">model =</span> mpd, <span class="at">observation_labels =</span> comp_labels[comp_ndx], <span class="at">plot.it =</span> F)</span>
<span id="cb13-49"><a href="mpd-summaries.html#cb13-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get the obs input file</span></span>
<span id="cb13-50"><a href="mpd-summaries.html#cb13-50" aria-hidden="true" tabindex="-1"></a>    vals[comp_ndx] <span class="ot">=</span> weight</span>
<span id="cb13-51"><a href="mpd-summaries.html#cb13-51" aria-hidden="true" tabindex="-1"></a>    this_obs <span class="ot">=</span> obs_csl2[[<span class="fu">paste0</span>(<span class="st">&quot;observation[&quot;</span>,comp_labels[comp_ndx],<span class="st">&quot;]&quot;</span>)]]</span>
<span id="cb13-52"><a href="mpd-summaries.html#cb13-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># change the subcommand &#39;error_value_multiplier&#39;</span></span>
<span id="cb13-53"><a href="mpd-summaries.html#cb13-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(this_obs<span class="sc">$</span>error_value_multiplier)) {</span>
<span id="cb13-54"><a href="mpd-summaries.html#cb13-54" aria-hidden="true" tabindex="-1"></a>      this_obs<span class="sc">$</span>error_value_multiplier <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb13-55"><a href="mpd-summaries.html#cb13-55" aria-hidden="true" tabindex="-1"></a>      this_obs<span class="sc">$</span>error_value_multiplier<span class="sc">$</span>value <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb13-56"><a href="mpd-summaries.html#cb13-56" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb13-57"><a href="mpd-summaries.html#cb13-57" aria-hidden="true" tabindex="-1"></a>      this_obs<span class="sc">$</span>error_value_multiplier<span class="sc">$</span>value <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb13-58"><a href="mpd-summaries.html#cb13-58" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-59"><a href="mpd-summaries.html#cb13-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the francis method wants weight = 1.0</span></span>
<span id="cb13-60"><a href="mpd-summaries.html#cb13-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-61"><a href="mpd-summaries.html#cb13-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check if the tolerance approx = 1</span></span>
<span id="cb13-62"><a href="mpd-summaries.html#cb13-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">abs</span>(<span class="dv">1</span> <span class="sc">-</span> weight) <span class="sc">&gt;</span> max_tolerance)</span>
<span id="cb13-63"><a href="mpd-summaries.html#cb13-63" aria-hidden="true" tabindex="-1"></a>      max_tolerance <span class="ot">=</span> <span class="fu">abs</span>(<span class="dv">1</span> <span class="sc">-</span> weight)</span>
<span id="cb13-64"><a href="mpd-summaries.html#cb13-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save the observation back into the overall config</span></span>
<span id="cb13-65"><a href="mpd-summaries.html#cb13-65" aria-hidden="true" tabindex="-1"></a>    obs_csl2[[<span class="fu">paste0</span>(<span class="st">&quot;observation[&quot;</span>,comp_labels[comp_ndx],<span class="st">&quot;]&quot;</span>)]] <span class="ot">=</span> this_obs</span>
<span id="cb13-66"><a href="mpd-summaries.html#cb13-66" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-67"><a href="mpd-summaries.html#cb13-67" aria-hidden="true" tabindex="-1"></a>  <span class="do">## priny the weights</span></span>
<span id="cb13-68"><a href="mpd-summaries.html#cb13-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(comp_labels, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb13-69"><a href="mpd-summaries.html#cb13-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">round</span>(vals,<span class="dv">5</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb13-70"><a href="mpd-summaries.html#cb13-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-71"><a href="mpd-summaries.html#cb13-71" aria-hidden="true" tabindex="-1"></a>  <span class="do">## write the file</span></span>
<span id="cb13-72"><a href="mpd-summaries.html#cb13-72" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Note!! this will overwrite &#39;Observation.csl2&#39; it will strip out all comments as well</span></span>
<span id="cb13-73"><a href="mpd-summaries.html#cb13-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csl2.file</span>(obs_csl2, <span class="at">file =</span> <span class="st">&quot;Observation.csl2&quot;</span>, <span class="at">path =</span> csl_dir)</span>
<span id="cb13-74"><a href="mpd-summaries.html#cb13-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-75"><a href="mpd-summaries.html#cb13-75" aria-hidden="true" tabindex="-1"></a>  <span class="do">## estimate the model with Casal2</span></span>
<span id="cb13-76"><a href="mpd-summaries.html#cb13-76" aria-hidden="true" tabindex="-1"></a>  current_dir <span class="ot">=</span> <span class="fu">getwd</span>()</span>
<span id="cb13-77"><a href="mpd-summaries.html#cb13-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setwd</span>(csl_dir)</span>
<span id="cb13-78"><a href="mpd-summaries.html#cb13-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">system2</span>(<span class="at">command =</span> <span class="st">&quot;casal2&quot;</span>, <span class="at">args =</span> <span class="st">&quot;-e&quot;</span>, <span class="at">stdout =</span> <span class="fu">paste0</span>(<span class="st">&quot;estimate_&quot;</span>,weighting_iterator,<span class="st">&quot;.log&quot;</span>), </span>
<span id="cb13-79"><a href="mpd-summaries.html#cb13-79" aria-hidden="true" tabindex="-1"></a>          <span class="at">stderr =</span> <span class="st">&quot;estimate.err&quot;</span>)</span>
<span id="cb13-80"><a href="mpd-summaries.html#cb13-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setwd</span>(current_dir)</span>
<span id="cb13-81"><a href="mpd-summaries.html#cb13-81" aria-hidden="true" tabindex="-1"></a>  weighting_iterator <span class="ot">=</span> weighting_iterator <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb13-82"><a href="mpd-summaries.html#cb13-82" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="model-quantities" class="section level3 hasAnchor" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Model quantities<a href="mpd-summaries.html#model-quantities" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="fishing-pressures" class="section level4 unnumbered hasAnchor">
<h4>Fishing Pressures<a href="mpd-summaries.html#fishing-pressures" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Below illustrates code to plot fishing pressure, but you can also easily adapt the code to plot catches. One thing to note, is Casal2 will report both <code>exploitation_rate</code> and <code>fishing_pressures</code>. For models that only have a single fishery per time-step or area these will be the same. If there are multiple fisheries interacting with the partition then they will differ. Fishing pressure is the maximum exploitation applied to the partition for that time-step and area. See the user manual for more detail on the difference. <code>exploitation_rate</code> reported is just
<span class="math display">\[
\frac{catch}{vunerable}
\]</span></p>
<p>Some R-code used to summarise fishing pressures.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="mpd-summaries.html#cb14-1" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">=</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;SimpleTestModel&quot;</span>, <span class="st">&quot;estimate.log&quot;</span>, </span>
<span id="cb14-2"><a href="mpd-summaries.html#cb14-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">package =</span> <span class="st">&quot;r4Casal2&quot;</span>, <span class="at">mustWork =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-3"><a href="mpd-summaries.html#cb14-3" aria-hidden="true" tabindex="-1"></a>mpd <span class="ot">=</span> <span class="fu">extract.mpd</span>(<span class="at">file =</span> file_name)</span>
<span id="cb14-4"><a href="mpd-summaries.html#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Report labels</span></span>
<span id="cb14-5"><a href="mpd-summaries.html#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># names(mpd) </span></span>
<span id="cb14-6"><a href="mpd-summaries.html#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot fishing pressures</span></span>
<span id="cb14-7"><a href="mpd-summaries.html#cb14-7" aria-hidden="true" tabindex="-1"></a>fishery_info <span class="ot">=</span> <span class="fu">get_fisheries</span>(mpd)</span>
<span id="cb14-8"><a href="mpd-summaries.html#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fishery_info)</span>
<span id="cb14-9"><a href="mpd-summaries.html#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Note this will print both fishing pressure and exploitation</span></span>
<span id="cb14-10"><a href="mpd-summaries.html#cb14-10" aria-hidden="true" tabindex="-1"></a>my_plot <span class="ot">=</span> <span class="fu">ggplot</span>(fishery_info, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> exploitation, <span class="at">col =</span> fishery, <span class="at">linetype =</span> fishery)) <span class="sc">+</span></span>
<span id="cb14-11"><a href="mpd-summaries.html#cb14-11" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">geom_line</span>(<span class="at">size =</span><span class="dv">2</span>)</span>
<span id="cb14-12"><a href="mpd-summaries.html#cb14-12" aria-hidden="true" tabindex="-1"></a>my_plot</span></code></pre></div>
<p><img src="_main_files/figure-html/pressures-1.png" width="576" />
Flexibility using standard ggplot functions</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="mpd-summaries.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># you can add adjust it as you please, for example if you want 3 panels for each fishery</span></span>
<span id="cb15-2"><a href="mpd-summaries.html#cb15-2" aria-hidden="true" tabindex="-1"></a>my_plot <span class="sc">+</span> </span>
<span id="cb15-3"><a href="mpd-summaries.html#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>fishery) <span class="sc">+</span> </span>
<span id="cb15-4"><a href="mpd-summaries.html#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/pressures_alt-1.png" width="576" /></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="mpd-summaries.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust ylim and add a reference limit</span></span>
<span id="cb16-2"><a href="mpd-summaries.html#cb16-2" aria-hidden="true" tabindex="-1"></a>my_plot <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="fl">0.09</span>) <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.05</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/pressures_alt_again-1.png" width="576" /></p>
</div>
<div id="plotting-selectivities" class="section level4 hasAnchor" number="4.1.3.1">
<h4><span class="header-section-number">4.1.3.1</span> Plotting selectivities<a href="mpd-summaries.html#plotting-selectivities" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="mpd-summaries.html#cb17-1" aria-hidden="true" tabindex="-1"></a>selectivity_df <span class="ot">=</span> <span class="fu">get_selectivities</span>(<span class="at">model =</span> mpd)</span>
<span id="cb17-2"><a href="mpd-summaries.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(selectivity_df, <span class="fu">aes</span>(<span class="at">x =</span> bin, <span class="at">y =</span> selectivity, <span class="at">col =</span> label)) <span class="sc">+</span></span>
<span id="cb17-3"><a href="mpd-summaries.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb17-4"><a href="mpd-summaries.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>label)</span></code></pre></div>
<p><img src="_main_files/figure-html/selectivities_mpd-1.png" width="576" /></p>
</div>
</div>
</div>
<div id="multiple-casal2-runs-with--i-or--s" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Multiple Casal2 runs with -i or -s<a href="mpd-summaries.html#multiple-casal2-runs-with--i-or--s" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="mpd-summaries.html#cb18-1" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">=</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;SimpleTestModel&quot;</span>,<span class="st">&quot;multi_run.log&quot;</span>, </span>
<span id="cb18-2"><a href="mpd-summaries.html#cb18-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">package =</span> <span class="st">&quot;r4Casal2&quot;</span>, <span class="at">mustWork =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-3"><a href="mpd-summaries.html#cb18-3" aria-hidden="true" tabindex="-1"></a>mpd <span class="ot">=</span> <span class="fu">extract.mpd</span>(<span class="at">file =</span> file_name)</span>
<span id="cb18-4"><a href="mpd-summaries.html#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Report labels</span></span>
<span id="cb18-5"><a href="mpd-summaries.html#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># names(mpd) </span></span>
<span id="cb18-6"><a href="mpd-summaries.html#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot fishing pressures</span></span>
<span id="cb18-7"><a href="mpd-summaries.html#cb18-7" aria-hidden="true" tabindex="-1"></a>fishery_df <span class="ot">=</span> <span class="fu">get_fisheries</span>(<span class="at">model =</span> mpd)</span>
<span id="cb18-8"><a href="mpd-summaries.html#cb18-8" aria-hidden="true" tabindex="-1"></a>my_plot <span class="ot">=</span> <span class="fu">ggplot</span>(fishery_df, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> exploitation, <span class="at">col =</span> <span class="fu">factor</span>(par_set))) <span class="sc">+</span></span>
<span id="cb18-9"><a href="mpd-summaries.html#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.4</span>) <span class="sc">+</span></span>
<span id="cb18-10"><a href="mpd-summaries.html#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>fishery)</span>
<span id="cb18-11"><a href="mpd-summaries.html#cb18-11" aria-hidden="true" tabindex="-1"></a>my_plot <span class="ot">=</span> my_plot <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>))</span>
<span id="cb18-12"><a href="mpd-summaries.html#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># this will generate a generic ggplot</span></span>
<span id="cb18-13"><a href="mpd-summaries.html#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_plot)</span></code></pre></div>
<p><img src="_main_files/figure-html/pressures_multi-1.png" width="576" /></p>
<div id="plotting-selectivities-1" class="section level3 unnumbered hasAnchor">
<h3>Plotting selectivities<a href="mpd-summaries.html#plotting-selectivities-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="mpd-summaries.html#cb19-1" aria-hidden="true" tabindex="-1"></a>selectivity_df <span class="ot">=</span> <span class="fu">get_selectivities</span>(mpd)</span>
<span id="cb19-2"><a href="mpd-summaries.html#cb19-2" aria-hidden="true" tabindex="-1"></a>selectivity_df<span class="sc">$</span>par_set <span class="ot">=</span> <span class="fu">factor</span>(selectivity_df<span class="sc">$</span>par_set, <span class="at">ordered =</span> T)</span>
<span id="cb19-3"><a href="mpd-summaries.html#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(selectivity_df, <span class="fu">aes</span>(<span class="at">x =</span> bin, <span class="at">y =</span> selectivity, <span class="at">col =</span> report_label, <span class="at">line_type =</span> par_set)) <span class="sc">+</span></span>
<span id="cb19-4"><a href="mpd-summaries.html#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb19-5"><a href="mpd-summaries.html#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(par_set<span class="sc">~</span>report_label)</span></code></pre></div>
<p><img src="_main_files/figure-html/selectivities_multi-1.png" width="768" /></p>
</div>
<div id="plotting-fits" class="section level3 unnumbered hasAnchor">
<h3>Plotting Fits<a href="mpd-summaries.html#plotting-fits" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="mpd-summaries.html#cb20-1" aria-hidden="true" tabindex="-1"></a>my_plot <span class="ot">=</span> <span class="fu">plot_relative_index</span>(<span class="at">model =</span> mpd, <span class="at">report_labels =</span> <span class="fu">c</span>(<span class="st">&quot;chatTANbiomass&quot;</span>), <span class="at">plot.it =</span> T, <span class="at">plot_type =</span> <span class="st">&quot;classic&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;multi iteration report found&quot;
## [1] &quot;multi iteration report found&quot;
## [1] &quot;multi iteration report found&quot;
## [1] &quot;multi iteration report found&quot;
## [1] &quot;multi iteration report found&quot;
## [1] &quot;multi iteration report found&quot;
## [1] &quot;multi iteration report found&quot;
## [1] &quot;multi iteration report found&quot;
## [1] &quot;multi iteration report found&quot;
## [1] &quot;multi iteration report found&quot;
## [1] &quot;multi iteration report found&quot;
## [1] &quot;multi iteration report found&quot;
## [1] &quot;multi iteration report found&quot;
## [1] &quot;multi iteration report found&quot;
## [1] &quot;multi iteration report found&quot;
## [1] &quot;multi iteration report found&quot;
## [1] &quot;multi iteration report found&quot;</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="mpd-summaries.html#cb22-1" aria-hidden="true" tabindex="-1"></a>my_plot</span></code></pre></div>
<p><img src="_main_files/figure-html/plot_relative_index-1.png" width="768" /></p>

</div>
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-francis2011data" class="csl-entry">
Francis, RIC Chris. 2011. <span>“Data Weighting in Statistical Fisheries Stock Assessment Models.”</span> <em>Canadian Journal of Fisheries and Aquatic Sciences</em> 68 (6): 1124–38.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="summariseinputs.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="summarisemultipleinputs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/NIWAFisheriesModelling/r4Casal2/edit/main/03-MPD.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
